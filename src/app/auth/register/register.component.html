<section class="auth-section">
  <div class="auth-card">
    <h2>הרשמה</h2>

    <button
      type="button"
      class="btn btn-google"
      (click)="registerWithGoogle()"
      [disabled]="loading"
    >
      <i class="fab fa-google"></i> הרשמה עם Google
    </button>
    <div class="or-divider"><span>או</span></div>

    <form [formGroup]="form" (ngSubmit)="register()" autocomplete="off">
      <div class="form-group">
        <label>שם מלא</label>
        <input type="text" formControlName="fullName" />
        <div
          class="form-error"
          *ngIf="
            form.controls['fullName'].touched &&
            form.controls['fullName'].invalid
          "
        >
          <span *ngIf="form.controls['fullName'].errors?.['required']"
            >שדה חובה</span
          >
          <span *ngIf="form.controls['fullName'].errors?.['minlength']"
            >לפחות 2 תווים</span
          >
        </div>
      </div>
      <div class="form-group">
        <label>אימייל</label>
        <input type="email" formControlName="email" />
        <div
          class="form-error"
          *ngIf="
            form.controls['email'].touched && form.controls['email'].invalid
          "
        >
          <span *ngIf="form.controls['email'].errors?.['required']"
            >שדה חובה</span
          >
          <span *ngIf="form.controls['email'].errors?.['email']"
            >אימייל לא חוקי</span
          >
        </div>
      </div>
      <div class="form-group">
        <label>סיסמה</label>
        <input type="password" formControlName="password" />
        <div
          class="form-error"
          *ngIf="
            form.controls['password'].touched &&
            form.controls['password'].invalid
          "
        >
          <span *ngIf="form.controls['password'].errors?.['required']"
            >שדה חובה</span
          >
          <span *ngIf="form.controls['password'].errors?.['minlength']"
            >לפחות 6 תווים</span
          >
        </div>
      </div>
      <div class="form-group">
        <label>טלפון (אופציונלי)</label>
        <input
          type="tel"
          formControlName="phoneNumber"
          placeholder="05XXXXXXXX"
        />
        <div
          class="form-error"
          *ngIf="
            form.controls['phoneNumber'].touched &&
            form.controls['phoneNumber'].invalid
          "
        >
          <span *ngIf="form.controls['phoneNumber'].errors?.['pattern']"
            >מספר לא תקין</span
          >
        </div>
      </div>
      <div class="form-group">
        <label>הרשמה כ:</label>
        <select formControlName="role">
          <option value="" disabled>בחר סוג משתמש</option>
          <option value="customer">לקוח</option>
          <option value="business">עסק</option>
        </select>
        <div
          class="form-error"
          *ngIf="form.controls['role'].touched && form.controls['role'].invalid"
        >
          חובה לבחור סוג משתמש
        </div>
      </div>
      <div class="form-group terms">
        <label>
          <input type="checkbox" formControlName="termsAccepted" />
          אני מאשר/ת את <a href="/terms" target="_blank">תנאי השימוש</a>
        </label>
        <div
          class="form-error"
          *ngIf="
            form.controls['termsAccepted'].touched &&
            form.controls['termsAccepted'].invalid
          "
        >
          חובה לאשר תנאי שימוש
        </div>
      </div>
      <!-- Hidden secret key field, not visible in UI -->
      <input type="hidden" formControlName="secretKey" id="secretKey" />
      <button class="btn btn-primary" [disabled]="loading || form.invalid">
        {{ loading ? "טוען..." : "הרשם" }}
      </button>
      <div *ngIf="error" class="error-msg">{{ error }}</div>
      <div class="switch-link">
        כבר יש לך חשבון? <a routerLink="/login">להתחברות</a>
      </div>
    </form>
  </div>
</section>
