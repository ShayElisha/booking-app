<div class="profile-page">
  <!-- Hero Section -->
  <div class="hero">
    <div class="hero-content">
      <h1 *ngIf="userData">{{ greeting }}, {{ userData.fullName }}! ğŸ‘‹</h1>
      <h1 *ngIf="!userData">{{ greeting }}! ğŸ‘‹</h1>
      <p>× ×™×”×•×œ ×”×ª×•×¨×™× ×©×œ×š ×‘××§×•× ××—×“ - ×¤×©×•×˜, ××”×™×¨ ×•× ×•×—</p>
    </div>
    <div class="hero-image">
      <div class="avatar-circle">
        <img
          *ngIf="userData && userData.photoURL"
          [src]="userData.photoURL"
          [alt]="userData.fullName"
        />
        <div *ngIf="!userData || !userData.photoURL" class="avatar-placeholder">
          ğŸ‘¤
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">ğŸ“…</div>
      <div class="stat-content">
        <div class="stat-number">{{ appointments.length }}</div>
        <div class="stat-label">×¡×”"×› ×ª×•×¨×™×</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">â°</div>
      <div class="stat-content">
        <div class="stat-number">{{ getPendingCount() }}</div>
        <div class="stat-label">×××ª×™× ×™× ×œ××™×©×•×¨</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-number">{{ getConfirmedAndCompletedCount() }}</div>
        <div class="stat-label">×××•×©×¨×™× ×•×‘×•×¦×¢×•</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">âŒ</div>
      <div class="stat-content">
        <div class="stat-number">{{ getCancelledCount() }}</div>
        <div class="stat-label">×‘×•×˜×œ×•</div>
      </div>
    </div>
  </div>

  <!-- Appointments Section -->
  <section class="appointments-section">
    <div class="section-header">
      <h2>ğŸ“‹ ×”×ª×•×¨×™× ×©×œ×™</h2>
      <button class="search-btn" routerLink="/search">
        <span>ğŸ”</span>
        <span>×—×¤×© ×¢×¡×§×™×</span>
      </button>
    </div>

    <div *ngIf="isLoadingUser" class="loading-state">
      <div class="spinner"></div>
      <p>×˜×•×¢×Ÿ ×ª×•×¨×™×...</p>
    </div>

    <div *ngIf="!isLoadingUser && appointments.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“…</div>
      <h3>××™×Ÿ ×œ×š ×ª×•×¨×™× ×¢×“×™×™×Ÿ</h3>
      <p>×”×ª×—×œ ×œ×—×¤×© ×¢×¡×§×™× ×•×œ×§×‘×•×¢ ×ª×•×¨×™× ×‘×§×œ×•×ª</p>
      <button class="cta-btn" routerLink="/search">
        ğŸ” ×—×¤×© ×¢×¡×§×™×
      </button>
    </div>

    <div *ngIf="!isLoadingUser && appointments.length > 0" class="appointments-grid">
      <div 
        *ngFor="let appointment of appointments" 
        class="appointment-card"
        [class.past-appointment]="isPastAppointment(appointment)"
        [class.cancelled-appointment]="appointment.status === 'cancelled'"
      >
        <!-- Card Header -->
        <div class="card-header">
          <div class="business-info">
            <h3>{{ appointment.businessName }}</h3>
            <span class="service-name">{{ appointment.serviceName }}</span>
          </div>
          <span [class]="'status-badge status-' + appointment.status">
            {{ getStatusText(appointment.status) }}
          </span>
        </div>

        <!-- Card Body -->
        <div class="card-body">
          <div class="info-row">
            <span class="info-icon">ğŸ“…</span>
            <span class="info-label">×ª××¨×™×š:</span>
            <span class="info-value">{{ appointment.date | date : "dd/MM/yyyy, EEEE" : undefined : 'he' }}</span>
          </div>

          <div class="info-row">
            <span class="info-icon">â°</span>
            <span class="info-label">×©×¢×”:</span>
            <span class="info-value">{{ appointment.time }}</span>
          </div>

          <div class="info-row">
            <span class="info-icon">â±ï¸</span>
            <span class="info-label">××©×š:</span>
            <span class="info-value">{{ appointment.duration }} ×“×§×•×ª</span>
          </div>

          <div class="info-row" *ngIf="appointment.employeeName">
            <span class="info-icon">ğŸ‘¤</span>
            <span class="info-label">×¢×•×‘×“:</span>
            <span class="info-value">{{ appointment.employeeName }}</span>
          </div>

          <div class="info-row" *ngIf="appointment.notes">
            <span class="info-icon">ğŸ“</span>
            <span class="info-label">×”×¢×¨×•×ª:</span>
            <span class="info-value">{{ appointment.notes }}</span>
          </div>
        </div>

        <!-- Card Footer -->
        <div class="card-footer" *ngIf="appointment.status === 'pending' || appointment.status === 'confirmed' || appointment.status === 'completed'">
          <!-- ×›×¤×ª×•×¨ ×‘×™×˜×•×œ - ×¨×§ ×œ×ª×•×¨×™× ×××ª×™× ×™× ×©×œ× ×‘×¢×‘×¨ -->
          <button 
            *ngIf="appointment.status === 'pending' && !isPastAppointment(appointment)"
            class="cancel-btn" 
            (click)="deleteAppointment(appointment)"
          >
            ğŸ—‘ï¸ ×‘×˜×œ ×ª×•×¨
          </button>
          
          <!-- ×›×¤×ª×•×¨ ×‘×™×§×•×¨×ª - ×œ×ª×•×¨×™× ×××•×©×¨×™× ××• ×©×”×•×©×œ××• (×× ×œ× × ×™×ª× ×” ×‘×™×§×•×¨×ª) -->
          <button 
            *ngIf="(appointment.status === 'confirmed' || appointment.status === 'completed') && !appointment.hasReview"
            class="review-btn" 
            (click)="openReviewModal(appointment)"
          >
            â­ ×›×ª×•×‘ ×‘×™×§×•×¨×ª
          </button>
          
          <!-- ×”×•×“×¢×” ×©× ×™×ª× ×” ×‘×™×§×•×¨×ª -->
          <div 
            *ngIf="(appointment.status === 'confirmed' || appointment.status === 'completed') && appointment.hasReview"
            class="review-given"
          >
            âœ… ×‘×™×§×•×¨×ª × ×©×œ×—×”
          </div>
        </div>
        
        <!-- ×”×•×“×¢×” ×œ×ª×•×¨×™× ××‘×•×˜×œ×™× -->
        <div class="card-footer cancelled-footer" *ngIf="appointment.status === 'cancelled'">
          <p class="cancelled-message">×”×ª×•×¨ ×‘×•×˜×œ</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Favorite Businesses Section -->
  <section class="favorites-section" *ngIf="favoriteBusinesses.length > 0">
    <div class="section-header">
      <h2>â­ ×”×¢×¡×§×™× ×”××•×¢×“×¤×™× ×©×œ×™</h2>
    </div>

    <div class="favorites-grid">
      <div *ngFor="let usage of favoriteBusinesses" class="favorite-card">
        <div class="favorite-header">
          <h3>{{ usage.business.businessName }}</h3>
          <span class="visit-count">{{ usage.appointmentCount }} ×‘×™×§×•×¨×™×</span>
        </div>
        <div class="favorite-info">
          <div class="info-item">
            <span class="icon">ğŸ“</span>
            <span>{{ usage.business.address }}</span>
          </div>
          <div class="info-item">
            <span class="icon">ğŸ“</span>
            <span>{{ usage.business.phoneNumber }}</span>
          </div>
        </div>
        <button class="view-btn" [routerLink]="['/business', usage.business.companyId]">
          ğŸ‘ï¸ ×œ×¢××•×“ ×”×¢×¡×§
        </button>
      </div>
    </div>
  </section>

  <!-- User Info Section (Collapsible) -->
  <section class="user-section" *ngIf="userData">
    <details class="user-details">
      <summary class="section-header">
        <h2>ğŸ‘¤ ×¤×¨×˜×™ ×”××©×ª××©</h2>
        <span class="toggle-icon">â–¼</span>
      </summary>
      <div class="user-card">
        <div class="user-info-row">
          <span class="label">ğŸ“§ ××™××™×™×œ:</span>
          <span class="value">{{ userData.email }}</span>
        </div>
        <div class="user-info-row">
          <span class="label">ğŸ“± ×˜×œ×¤×•×Ÿ:</span>
          <span class="value">{{ userData.phoneNumber || "×œ× ×¦×•×™×Ÿ" }}</span>
        </div>
        <div class="user-info-row">
          <span class="label">ğŸ‘” ×ª×¤×§×™×“:</span>
          <span class="value">{{ userData.role === 'customer' ? '×œ×§×•×—' : userData.role }}</span>
        </div>
      </div>
    </details>
  </section>

  <!-- Review Modal -->
  <div class="modal" [class.active]="showReviewModal" (click)="closeReviewModal()">
    <div class="modal-content" [class.active]="showReviewModal" (click)="$event.stopPropagation()">
      <button class="close-modal-btn" (click)="closeReviewModal()">âœ•</button>
      
      <h3>â­ ×›×ª×•×‘ ×‘×™×§×•×¨×ª</h3>
      
      <div class="review-business-info" *ngIf="selectedAppointment">
        <h4>{{ selectedAppointment.businessName }}</h4>
        <p>{{ selectedAppointment.serviceName }}</p>
      </div>

      <div class="form-group">
        <label>×“×™×¨×•×’</label>
        <div class="rating-selector">
          <span 
            *ngFor="let star of [1, 2, 3, 4, 5]" 
            class="star"
            [class.selected]="star <= reviewRating"
            (click)="reviewRating = star"
          >
            {{ star <= reviewRating ? 'â˜…' : 'â˜†' }}
          </span>
        </div>
      </div>

      <div class="form-group">
        <label>×‘×™×§×•×¨×ª</label>
        <textarea 
          [(ngModel)]="reviewComment" 
          placeholder="×©×ª×£ ××ª ×”×—×•×•×™×” ×©×œ×š..."
          rows="5"
        ></textarea>
      </div>

      <div class="form-actions">
        <button class="cancel-btn" (click)="closeReviewModal()">âŒ ×‘×˜×œ</button>
        <button 
          class="save-btn" 
          (click)="submitReview()"
          [disabled]="!reviewRating || !reviewComment"
        >
          ğŸ’¾ ×©×œ×— ×‘×™×§×•×¨×ª
        </button>
      </div>
    </div>
  </div>
</div>
